{% extends "base.html" %}

{% block title %}Details and Charts{% endblock %}

{% block content %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="login.css">
    <title>Spending Overview</title>
    <script>
        function updateSubcategories() {
            const level1 = document.getElementById("category-level-1").value;
            const level2 = document.getElementById("category-level-2");
            level2.innerHTML = "";
            level2.disabled = false;

            let options = [];
            if (level1 === "All Spending") {
                options = ["All"];
            } else if (level1 === "Necessities") {
                options = ["All", "Tuition", "Housing", "Food", "Transportation"];
            } else if (level1 === "Flexible_spending") {
                options = ["All", "Study_material", "Entertainment", "Technology", "Personal_care"];
            } else if (level1 === "Others") {
                options = ["All", "Apparel", "Travel", "Others"];
            } else if (level1 === "Disposable_income") {
                options = ["All", "living_expenses", "Allowance", "Income"];
            } else {
                level2.disabled = true;
                return;
            }

            options.forEach(option => {
                const opt = document.createElement("option");
                opt.value = option;
                opt.textContent = option;
                level2.appendChild(opt);
            });
        }
    </script>
</head>
<body>
    <div class="container">
        <!-- Category Selection -->
        <div class="category-selection">
            <label for="category-level-1">Category-Level-1:</label>
            <select id="category-level-1" name="category-level-1" onchange="updateSubcategories()">
                <option value="All Spending" selected>All Spending</option>
                <option value="Necessities">Necessities</option>
                <option value="Flexible_spending">Flexible Spending</option>
                <option value="Others">Others</option>
                <option value="Disposable_income">Disposable Income</option>
            </select>

            <label for="category-level-2">Subcategory-Level-2:</label>
            <select id="category-level-2" name="category-level-2" disabled>
                <option value="All" selected>All</option>
            </select>
        </div>

        <!-- Block 1: User Spending Records -->
        <div class="block block-1 spending-summary">
            <h3>Spending Records</h3>
            <div class="spending-records" id="spending-records" style="overflow-y: auto; max-height: 400px;">
                {% for record in records %}
                    <div class="record">
                        <p>Amount: {{ record.amount }}, Category: {{ record.category }}, Date: {{ record.date }}</p>
                        <button onclick="showNote('{{ record.note }}')" class="btn btn-secondary">Show Note</button>
                    </div>
                {% endfor %}
            </div>
        </div>


        <div class="block block-2">
            <h3>Spending Distribution Chart</h3>
            <img src="{{ url_for('static', filename='normal_distribution.png') }}" alt="Normal Distribution Chart">
        </div>
    
        <div class="block block-3">
            <h3>Monthly Spending Chart</h3>
            <img src="{{ url_for('static', filename='monthly_spending.png') }}" alt="Monthly Spending Chart">
        </div>

    <script>
        function showNote(note) {
            alert(note);
        }
    </script>
</body>
</html>
{% endblock %}
